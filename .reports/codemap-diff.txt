# Codemap Generation Report
# Generated: 2026-02-03
# Project: LiveStreamInfoRetrievalProject
# Version: 0.1.0

## Summary

Generated comprehensive codemap documentation for the Douyin Live Stream Danmaku Voice Broadcast project.

## Files Created

1. codemaps/architecture.md (265 lines)
   - Overall system architecture
   - Data flow diagrams
   - Key modules overview
   - Threading model
   - Testing structure

2. codemaps/backend.md (230 lines)
   - Douyin connector implementations
   - Message parser architecture
   - Protobuf handling
   - Cookie management
   - API client details

3. codemaps/frontend.md (200 lines)
   - CLI interface documentation
   - Output formats
   - Logging configuration
   - Audio output (TTS + Player)
   - User interaction flow

4. codemaps/data.md (180 lines)
   - Configuration data models
   - Message data structures
   - Protobuf schemas
   - WebSocket URL parameters
   - Cache data structure

5. codemaps/INDEX.md (150 lines)
   - Navigation index
   - Quick reference
   - Project structure overview
   - Component mapping

## Source Files Analyzed

### Core Application (1 file)
- main.py - DanmakuOrchestrator entry point

### Config Module (3 files)
- src/config/__init__.py
- src/config/defaults.py - AppConfig, RoomConfig, TTSConfig, etc.
- src/config/loader.py - Config file parser

### Douyin Module (19 files)
- src/douyin/__init__.py
- src/douyin/api.py - DouyinAPI client
- src/douyin/cookie.py - CookieManager
- src/douyin/protobuf.py - PushFrame codec
- src/douyin/connector.py - DouyinConnector base
- src/douyin/connector_real.py - Playwright-based
- src/douyin/connector_http.py - HTTP polling
- src/douyin/connector_websocket_listener.py - Browser listener
- src/douyin/connector_v2.py - Alternative impl
- src/douyin/connector_v3.py - URL capture
- src/douyin/connector_v4.py - Chat detection
- src/douyin/parser.py - MessageParser
- src/douyin/parser_real.py - RealtimeMessageParser
- src/douyin/parser_http.py - HTTPResponseParser
- src/douyin/parser_v2.py - ImprovedMessageParser
- src/douyin/message_parser.py - Legacy parser
- src/douyin/websocket_extractor.py

### TTS Module (2 files)
- src/tts/__init__.py
- src/tts/edge_tts.py - EdgeTTSEngine

### Player Module (2 files)
- src/player/__init__.py
- src/player/pygame_player.py - PygamePlayer

### Filter Module (1 file)
- src/filter/__init__.py (stub)

### Utils Module (1 file)
- src/utils/__init__.py (stub)

### Test Files (18 files)
- test_config.py
- test_cookie.py
- test_connector.py
- test_edge_tts.py
- test_pygame_player.py
- test_*.py (various integration tests)

### Tools (3 files)
- tools/capture_websocket.py
- tools/test_domains.py
- tools/get_room_id.py

## Dependencies Mapped

### Core Dependencies
- websockets==12.0 - WebSocket client
- protobuf==4.25.1 - Protocol buffers
- edge-tts==6.1.9 - Text-to-speech
- pygame==2.5.2 - Audio playback

### Support Dependencies
- aiohttp==3.9.1 - Async HTTP
- configparser==6.0.0 - INI parsing
- python-dotenv==1.0.0 - Environment
- colorlog==6.8.0 - Logging

### Optional Dependencies
- playwright - Browser automation

## Data Structures Documented

1. **Configuration Models (8 dataclasses)**
   - AppConfig
   - RoomConfig
   - TTSConfig
   - FilterConfig
   - FilterUserConfig
   - FilterKeywordConfig
   - PlaybackConfig
   - LogConfig

2. **Message Models (3 classes)**
   - UserInfo (with id, nickname, level, badge)
   - ParsedMessage (with method, user, content, gift info)
   - DanmakuMessage (legacy format)

3. **Protobuf Models**
   - PushFrame (9 fields with wire format)

## Connector Variants Documented (6 types)

1. DouyinConnectorMock - Test mode
2. DouyinConnector - Standard WebSocket
3. DouyinConnectorReal - Playwright with signature
4. DouyinHTTPConnector - HTTP polling
5. WebSocketListenerConnector - Browser WS interception
6. DouyinConnectorV2/V3/V4 - Experimental versions

## Parser Variants Documented (4 types)

1. MessageParser - Basic protobuf + regex
2. RealtimeMessageParser - Field 8 extraction
3. HTTPResponseParser - HTTP response regex
4. ImprovedMessageParser - Enhanced extraction

## Message Types Documented (12+ types)

- WebChatMessage
- WebGiftMessage
- WebLiveEndEvent
- WebcastRoomStatsMessage
- WebcastRoomUserSeqMessage
- WebcastLikeMessage
- MemberMessage
- ControlMessage
- WebcastRoomRankMessage
- WebcastSocialMessage
- WebcastInRoomBannerMessage
- Unknown

## Key Features Documented

1. **Multiple Connection Strategies**
   - Direct WebSocket (no browser)
   - Playwright-assisted (browser automation)
   - HTTP polling (JavaScript fetch)
   - WebSocket interception (browser hooking)

2. **Message Parsing**
   - Protobuf varint decoding
   - Gzip decompression
   - String extraction
   - Pattern matching

3. **Audio Pipeline**
   - Text-to-speech with caching
   - Queue-based playback
   - Volume/rate controls

4. **Configuration System**
   - Default values (dataclasses)
   - INI file loading
   - Validation and merge

## Export Statistics

- Total Python files analyzed: 50+
- Total lines of documentation: 1,025
- Total data structures: 14
- Total connector types: 6
- Total parser types: 4
- Total message types: 12+

## Validation Checklist

- [x] All source files read and analyzed
- [x] All imports mapped to dependencies
- [x] All dataclasses documented
- [x] All async methods noted
- [x] All connector variants compared
- [x] All parser types described
- [x] Configuration format documented
- [x] Message flow diagram created
- [x] Timestamps added to all files
- [x] Cross-references between codemaps

## Notes

- Project is a CLI application with no GUI
- Requires Chrome debug mode for some connectors
- ttwid cookie must be manually obtained
- Protobuf schemas are reverse-engineered
- Audio files cached with MD5 hash keys
- All connectors use async/await pattern
