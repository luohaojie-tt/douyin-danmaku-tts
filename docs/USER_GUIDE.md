# 用户使用手册

## 📋 目录

1. [快速开始](#快速开始)
2. [界面介绍](#界面介绍)
3. [连接直播间](#连接直播间)
4. [播放控制](#播放控制)
5. [设置说明](#设置说明)
6. [数据导出](#数据导出)
7. [常见问题](#常见问题)

---

## 快速开始

### 系统要求

- **操作系统**: Windows 10/11 (64位)
- **浏览器**: Google Chrome（必须安装）
- **网络**: 首次使用需要网络连接（TTS语音生成）
- **磁盘空间**: 至少 100MB 可用空间

### 首次使用

1. **获取Cookie**
   - 打开浏览器访问 https://live.douyin.com
   - 按 F12 打开开发者工具
   - 切换到 Application → Cookies
   - 找到 `ttwid` 字段，复制其值
   - 在项目目录创建 `cookies.txt` 文件并粘贴该值

2. **启动程序**
   - 双击 `抖音弹幕播报.exe`
   - 或运行 `python main_gui.py`（开发版本）

3. **连接直播间**
   - 输入抖音直播间房间号
   - 点击"连接"按钮
   - 首次使用会自动启动Chrome调试模式

---

## 界面介绍

### 主窗口布局

```
┌─────────────────────────────────────────────────┐
│  菜单栏                                    │
│  ┌──────────┬──────────────────────┐      │
│  │          │                      │      │
│  │  控制面板  │   弹幕显示区域    │      │
│  │          │                      │      │
│  │          │                      │      │
│  │  ────────┴────────────────────  │      │
│  │          日志输出区域                │      │
│  └──────────────────────────────────┘      │
│  状态栏                                    │
└─────────────────────────────────────────────────┘
```

### 菜单栏

- **文件**
  - 导出TXT - 导出弹幕记录为文本文件
  - 导出JSON - 导出弹幕记录为JSON格式
  - 清空历史 - 清除当前会话的弹幕记录
  - 退出 - 关闭程序

- **设置**
  - 打开配置文件 - 用记事本打开config.ini
  - 打开日志目录 - 打开logs文件夹
  - 打开缓存目录 - 打开cache文件夹

- **帮助**
  - 关于 - 显示版本信息

### 控制面板（左侧）

**连接设置：**
- 房间号输入框 - 输入抖音直播间ID
- 记住房间号 - 勾选后自动记住房间号
- 连接/断开按钮 - 控制连接状态

**TTS设置：**
- 语速滑块 - 调整语音播放速度（-50% ~ +100%）
- 音量滑块 - 调整播放音量（0.0 ~ 1.0）
- 启用TTS - 开关语音播报功能

**黑名单管理：**
- 用户黑名单 - 过滤特定用户的弹幕
- 关键词黑名单 - 过滤包含特定关键词的弹幕
- 实时生效 - 修改后立即生效

### 弹幕显示区域（右侧）

- 实时显示接收到的弹幕
- 显示格式：`[时间] 用户名: 弹幕内容`
- 自动滚动到最新消息
- 支持手动滚动查看历史

### 日志输出区域（底部）

- 显示程序运行日志
- 错误信息高亮显示
- 帮助排查问题

### 状态栏

```
连接状态: ✅已连接 | 消息: 123 | 错误: 0
```

- 连接状态图标（绿色=已连接，红色=已断开）
- 消息计数器
- 错误计数器

---

## 连接直播间

### 获取房间号

**方法1：从直播URL获取**
```
https://live.douyin.com/123456789
                        ↑
                  房间号
```

**方法2：使用工具**
```bash
python tools/get_room_id.py
```
然后输入直播页面URL。

### 连接步骤

1. 在"房间号"输入框输入房间ID
2. 点击"连接"按钮
3. 等待连接成功提示
4. 开始监听弹幕

### 连接模式说明

程序自动选择最佳连接方式：

| 模式 | 说明 | 优点 |
|------|------|------|
| WebSocket监听 | 最稳定，延迟最低 | 推荐使用 |
| HTTP轮询 | 备用方案，兼容性好 | 稳定 |
| Mock测试 | 不连接网络，用于测试 | 测试用 |

---

## 播放控制

### 调整播放参数

**语速调整**
- 向左拖动：减慢语速（最低-50%）
- 向右拖动：加快语速（最高+100%）
- 实时生效，无需重新连接
- 推荐设置：+0%（正常速度）

**音量调整**
- 向左拖动：降低音量
- 向右拖动：提高音量
- 实时生效
- 推荐设置：0.7（70%音量）

**静音/启用**
- 取消勾选"启用TTS"：临时禁用语音播报
- 勾选"启用TTS"：恢复语音播报
- 弹幕仍会显示在界面上

### 黑名单使用

**添加用户黑名单**
1. 在"用户黑名单"输入框输入用户名
2. 点击"添加"按钮
3. 该用户的弹幕将不再播报和显示

**添加关键词黑名单**
1. 在"关键词黑名单"输入框输入关键词
2. 点击"添加"按钮
3. 包含该关键词的弹幕将被过滤

**删除黑名单项**
- 在列表中右键点击项目
- 选择"删除"即可移除

---

## 设置说明

### 配置文件结构

`config.ini` 文件包含以下部分：

```ini
[gui]
last_room_id = 123456789
remember_room = true

[tts]
voice = zh-CN-XiaoxiaoNeural
rate = +0%
volume = +0%

[playback]
volume = 0.7

[blacklist]
users = 用户1,用户2
keywords = 关键词1,关键词2
```

### 修改配置

**方法1：通过GUI修改**
- 所有设置都可以通过界面修改
- 修改后自动保存到配置文件

**方法2：手动编辑**
1. 点击菜单：设置 → 打开配置文件
2. 使用记事本编辑
3. 保存后重启程序生效

### Cookie配置

`cookies.txt` 文件格式：
```
ttwid=1%2C3...
```

**注意事项：**
- 仅需要 `ttwid` 字段的值
- Cookie有效期约7天，过期后需重新获取
- 请妥善保管，不要泄露给他人

---

## 数据导出

### 导出为TXT

1. 点击菜单：文件 → 导出TXT
2. 选择保存位置
3. 输入文件名
4. 点击保存

**导出格式：**
```
============================================================
弹幕记录导出
房间ID: 123456789
导出时间: 2026-02-11 19:30:00
消息总数: 150
============================================================

[2026-02-11 19:15:23] 用户A: 大家好
[2026-02-11 19:15:25] 用户B: 主播好
...
```

### 导出为JSON

1. 点击菜单：文件 → 导出JSON
2. 选择保存位置
3. 输入文件名
4. 点击保存

**导出格式：**
```json
{
  "room_id": "123456789",
  "export_time": "2026-02-11T19:30:00",
  "total_messages": 150,
  "stats": {
    "messages_received": 150,
    "messages_played": 145,
    "errors": 2
  },
  "messages": [
    {
      "timestamp": "2026-02-11T19:15:23",
      "user_name": "用户A",
      "content": "大家好",
      "method": "WebChatMessage"
    },
    ...
  ]
}
```

### 清空历史

- 点击菜单：文件 → 清空历史
- 仅清除当前会话的显示记录
- 不影响配置文件和缓存

---

## 常见问题

### Q: 程序无法启动？

**可能原因和解决方法：**

1. **缺少Chrome**
   - 下载安装：https://www.google.com/chrome/

2. **缺少DLL文件**
   - 下载安装：[Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)

3. **被杀毒软件拦截**
   - 添加到白名单或临时关闭杀毒软件

4. **Cookie文件缺失**
   - 创建 `cookies.txt` 文件并添加ttwid值

### Q: 连接失败？

**检查步骤：**

1. ✅ 确认房间号正确
2. ✅ 确认Chrome在调试模式运行（程序会自动启动）
3. ✅ 确认网络连接正常
4. ✅ 确认Cookie未过期
5. ✅ 查看日志区域的错误提示

**错误代码：**
- `Chrome not found` - Chrome未安装
- `Connection timeout` - 连接超时，检查网络
- `Invalid room ID` - 房间号不存在

### Q: 没有声音？

**解决方法：**

1. 检查系统音量是否静音
2. 检查"启用TTS"是否勾选
3. 检查音量滑块是否设置过低
4. 检查网络连接（TTS需要网络）
5. 测试系统音频播放（播放其他音频文件）

### Q: 弹幕显示但语音播报卡顿？

**优化建议：**

1. 降低"语速"设置（过高语速可能导致卡顿）
2. 检查网络速度
3. 清空 `cache/` 目录（缓存过多可能影响性能）
4. 重启程序

### Q: Chrome调试模式启动失败？

**解决方法：**

1. 手动启动Chrome：
   ```bash
   chrome.exe --remote-debugging-port=9222
   ```

2. 关闭现有Chrome进程：
   - 打开任务管理器
   - 结束所有chrome.exe进程
   - 重新启动程序

### Q: 如何更新程序？

**简单替换步骤：**

1. 下载新版本的 `抖音弹幕播报.exe`
2. 关闭当前运行的程序
3. 用新文件替换旧exe文件
4. 双击启动新版本

**注意：**
- ✅ 配置文件（config.ini）会保留
- ✅ Cookie（cookies.txt）会保留
- ✅ TTS缓存（cache/）会保留
- ✅ 日志文件（logs/）会保留

### Q: 如何完全卸载？

由于程序不写入注册表，卸载非常简单：

1. 关闭程序
2. 删除整个安装目录
3. （可选）删除桌面快捷方式

---

## 技巧和最佳实践

### 提高TTS速度

- 首次播报会下载音频并缓存
- 相同内容的弹幕直接使用缓存，无需网络
- `cache/` 目录会自动增长，可定期清理

### 优化性能

- 使用"用户黑名单"过滤不关心的用户
- 使用"关键词黑名单"过滤垃圾信息
- 禁用TTS仅查看弹幕（不播报）

### 数据备份

建议定期导出弹幕记录：
- 重要直播内容可以保存为TXT或JSON
- 导出文件可用文本编辑器查看或分析

---

## 获取帮助

如果遇到未 covered 的问题：

1. 查看日志输出区域
2. 打开 `logs/` 目录查看详细日志
3. 在GitHub提交Issue：https://github.com/yourusername/yourrepo/issues
4. 提供以下信息：
   - 程序版本号
   - 错误日志
   - 系统版本（Windows 10/11）
   - Chrome版本号
